<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Chat Test</title>
  </head>
  <body>
    <h2>ğŸ’¬ ì±„íŒ… í…ŒìŠ¤íŠ¸</h2>
    <label>
      ìœ ì € ID:
      <input id="userId" type="number" placeholder="ì˜ˆ: 101" />
    </label>
    <br />
    <label>
      ë‹‰ë„¤ì„:
      <input id="nickname" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™" />
    </label>
    <br />
    <label>
      ë©”ì‹œì§€:
      <input id="msg" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
    </label>
    <button onclick="sendMessage()">ì „ì†¡</button>

    <ul id="log"></ul>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const socket = io('http://localhost:3000', {
        transports: ['websocket'],
      });

      socket.on('connect', () => {
        log('âœ… ì—°ê²°ë¨: ' + socket.id);

        // ì„¸ì…˜ ID 1ë²ˆì— ìë™ ì…ì¥
        socket.emit('join', 1);
      });

      socket.on('chat', data => {
        log(`ğŸ’¬ ${data.senderNickname}: ${data.message}`);
      });

      function sendMessage() {
        const senderId = parseInt(document.getElementById('userId').value);
        const senderName = document.getElementById('nickname').value;
        const message = document.getElementById('msg').value;

        if (!senderId || !senderName || !message) {
          alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        socket.emit('chat', {
          sessionId: 1,
          senderId,
          message,
        });

        document.getElementById('msg').value = '';
      }

      function log(msg) {
        const li = document.createElement('li');
        li.innerText = msg;
        document.getElementById('log').appendChild(li);
      }
    </script>
  </body>
</html>
